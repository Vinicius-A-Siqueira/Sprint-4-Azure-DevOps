# Multi-stage build
FROM maven:3.8.6-openjdk-18 AS builder

WORKDIR /app

# Copiar arquivos de dependência
COPY pom.xml .
RUN mvn dependency:resolve

# Copiar código-fonte
COPY src ./src

# Build da aplicação
RUN mvn clean package -DskipTests

# Stage de runtime
FROM openjdk:18-slim

WORKDIR /app

# Copiar JAR do builder
COPY --from=builder /app/target/*.jar app.jar

# Expor porta
EXPOSE 8080

# Variáveis de ambiente
ENV SPRING_DATASOURCE_URL=jdbc:sqlserver://mottu-sqlserver.database.windows.net:1433;database=mottodb;encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30;
ENV SPRING_DATASOURCE_USERNAME=sqladmin@mottu-sqlserver
ENV SPRING_DATASOURCE_PASSWORD=P@ssw0rd1234

# Comando para iniciar
ENTRYPOINT ["java", "-jar", "app.jar"]
