# Stage 1: Build
FROM maven:3.8.6-eclipse-temurin-17 AS builder

WORKDIR /app

# Copiar arquivos de dependência
COPY pom.xml .
RUN mvn dependency:resolve

# Copiar código-fonte
COPY src ./src

# Build da aplicação
RUN mvn clean package -DskipTests

# Stage 2: Runtime
FROM eclipse-temurin:17-jre

WORKDIR /app

# Copiar JAR do builder
audhCOPY --from=builder /app/target/*.jar app.jar

# Expor porta
EXPOSE 8080

# Variáveis de ambiente (altere as senhas para não deixar fixas em produção)
ENV SPRING_DATASOURCE_URL=jdbc:sqlserver://mottu-sqlserver.database.windows.net:1433;database=mottodb;encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30;
ENV SPRING_DATASOURCE_USERNAME=sqladmin@mottu-sqlserver
ENV SPRING_DATASOURCE_PASSWORD=P@ssw0rd1234

# Comando para iniciar
ENTRYPOINT ["java", "-jar", "app.jar"]
